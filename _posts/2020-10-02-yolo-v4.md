---
layout: post
title: "YOLOv4 - nhanh hơn, chính xác hơn nữa !"
description: "YOLOv4 ."
thumb_image: "yolo-v4/yolov4_compare_figure.png"
tags: [deep-learning, computer-vision]
---

## Nội dung chính

1. [Giới thiệu](#giới-thiệu)
2. [Cải tiến](#cải-tiến)
3. [Thiết kế YOLOv4](#thiết-kế-yolov4)
4. [Thực nghiệm](#thực-nghiệm)
5. [Kết luận](#kết-luận)

# Giới thiệu

YOLOv4 đã giải quyết hai bài toán rất thực tế:

- Làm sao để có thể training model hiệu quả với một GPU duy nhất (GTX 1080Ti, RTX 2080Ti) ?
- Làm sao để model có thể đạt tốc độ real-time trên các thiết bị GPU (Maxwell/Pascal/Volta) ?

Xuyên suốt paper dài 17 trang, nhóm tác giả ghi ra chi tiết từng bước training và các thay đổi nhỏ trong model giúp tăng độ chính xác mà không ảnh hưởng nhiều đến tốc độ chay của model.

Do vậy, YOLOv4 được hưởng ứng khá rộng rãi bởi cộng đồng coder trong thời gian ngắn. Bạn có thể dễ dàng triển khai YOLOv4 trên mọi ngôn ngữ hay nền tảng: darknet, tensorflow, pytorch, keras, caffe, matlab, tensorrt, tensorflow lite, ... Thậm chí, NVIDIA gần đây mới public code triển khai YOLOv4 cho Deepstream 5.0.

Thế nên ta không còn phải hoài nghi về tính trung thực của paper YOLOv4 nữa. Hãy cùng đào sâu hơn nào!

{% include image.html path="yolo-v4/yolov4_compare_figure.png" path-detail="yolo-v4/yolov4_compare_figure.png" alt="so sánh YOLOv4 với các mô hình state-of-the-art khác" caption="YOLOv4 chạy nhanh gấp đôi so với EfficientDet với hiệu suất tương đương. Cải tiến YOLOv3 Average Precision tăng 10% và FPS tăng 12%. Lưu í rằng, vùng màu xanh thể hiện mô hình có thể chạy với tốc độ real-time."  %}

# Cải tiến

Nhóm tác giả chia các phương cải tiến model ra thành hai loại chính:

##### Loại 1: Bag of Freebies (BoF)

> Các phương pháp giúp model tăng độ chính xác mà không làm giảm tốc độ chạy. Những phương pháp này đạt được nhờ chiến thuật training đúng đắn, chỉ tăng chi phí khi training.

##### Loại 2: Bag of Special (BoS)

> Các phương pháp hoặc các mô-đun ảnh hưởng nhẹ đến tốc độ chạy, nhưng đem cải thiện độ chính xác cho model một cách đáng kể.

<style>
    table, th, td{
        border: solid #000 1px;
    }
</style>
<table>
    <tbody>
        <tr>
            <th></th>
            <th align="center">Backbone</th>
            <th align="center">Detector</th>
        </tr>
        <tr>
            <td>Bag of Freebies</td>
            <td>
                <ul>
                    <li>CutMix, Mosaic data augmentation</li>
                    <li>DropBlock regularization</li>
                    <li>Class label smoothing</li>
                </ul>
            </td>
            <td>
                <ul>
                    <li>Mish activation</li>
                    <li>Cross-stage partial connections (CSP)</li>
                    <li>Multi-input weighted residual connectios (MiWRC)</li>
                </ul>
            </td>
        </tr>
        <tr>
            <td>
                Bag of Specials
            </td>
            <td>
                <ul>
                    <li>Mosaic data augmentation</li>
                    <li>DropBlock regularization</li>
                    <li>CIoU-loss</li>
                    <li>CmBN</li>
                    <li>Self-Adversarial Training</li>
                    <li>Eliminate grid sensitivity</li>
                    <li>Sử dụng nhiều anchors cho một groud truth</li>
                    <li>Cosine annealing scheduler</li>
                    <li>Optimal hyper-parameters</li>
                    <li>Random training shapes</li>
                </ul>
            </td>
            <td>
                <ul>
                    <li>Mish activation</li>
                    <li>SPP-block</li>
                    <li>SAM-block</li>
                    <li>PAN path-aggregation block</li>
                    <li>DIoU-NMS</li>
                </ul>
            </td>
        </tr>
    </tbody>
</table>


# Thiết kế YOLOv4

Thiết kế của YOLOv4 được mô tả như sau:

1. Backbone: CSPDarknet53

{% include image.html path="yolo-v4/backbone-selection.png" path-detail="yolo-v4/backbone-selection.png" alt="So sánh các mô hình mạng phân loại ảnh" caption="So sánh tham số của các mô hình mạng phân loại ảnh."  %}

Để chọn ra một mô hình mạng phù hợp làm backbone và tối ưu tốc độ trong môi trường thực tế. Thay vì quan tâm đến khối lượng tính toán lý thuyết BFLOP, nhóm tác giả đưa ra 2 gợi í:

* Đối với GPU: số lượng nhóm các lớp Convolution nhỏ, như CSPResNeXt50 hoặc CSPDarknet53. Trên thực nghiệm, CSP ResNeXt50 có khả năng trích xuất ra nhiều features khác nhau giúp tăng tính so sánh. Tuy nhiên CSPDarknet53 lại thể hiện tính chính xác hơn trong việc xác định vị trí vật thể.

* Đối với VPU: EfficientNet-lite, MixNet, GhostNet hoặc MobileNetv3.


2. Neck: SPP, PAN

3. Head: YOLOv3



# Thực nghiệm

# Kết luận
